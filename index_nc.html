


<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>KBDemo | 客製化鍵盤選物與鍵帽工作室</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@400;500;600;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        color-scheme: dark;
        --bg: #0a0d12;
        --bg-soft: #0f141c;
        --surface: #151b26;
        --surface-2: #1c2432;
        --surface-3: #222c3c;
        --text: #f4f4ed;
        --text-soft: #a9b4c2;
        --accent: #ff8a1f;
        --accent-2: #4be0b5;
        --accent-3: #ffe37b;
        --danger: #ff6b6b;
        --line: rgba(255, 255, 255, 0.08);
        --glow: rgba(255, 138, 31, 0.35);
        --shadow: 0 20px 60px rgba(0, 0, 0, 0.45);
        --radius-lg: 28px;
        --radius-md: 18px;
        --radius-sm: 12px;
        --font-display: "Chakra Petch", sans-serif;
        --font-body: "Noto Sans TC", system-ui, -apple-system, sans-serif;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        font-family: var(--font-body);
        background: radial-gradient(
            circle at 15% 15%,
            rgba(75, 224, 181, 0.22),
            transparent 50%
          ),
          radial-gradient(
            circle at 80% 10%,
            rgba(255, 227, 123, 0.2),
            transparent 55%
          ),
          linear-gradient(160deg, #07090d 0%, #0f141d 55%, #090c11 100%);
        color: var(--text);
        overflow-x: hidden;
      }

      body::before {
        content: "";
        position: fixed;
        inset: 0;
        background-image: linear-gradient(
            rgba(255, 255, 255, 0.03) 1px,
            transparent 1px
          ),
          linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
        background-size: 42px 42px;
        opacity: 0.4;
        pointer-events: none;
        z-index: 0;
      }

      .orb {
        position: fixed;
        width: 420px;
        height: 420px;
        border-radius: 50%;
        filter: blur(60px);
        opacity: 0.35;
        z-index: 0;
      }

      .orb.orb-a {
        top: -120px;
        left: -120px;
        background: radial-gradient(circle, rgba(255, 138, 31, 0.5), transparent 70%);
      }

      .orb.orb-b {
        bottom: -180px;
        right: -140px;
        background: radial-gradient(circle, rgba(75, 224, 181, 0.4), transparent 70%);
      }

      a {
        color: inherit;
        text-decoration: none;
      }

      .container {
        width: min(1200px, 92vw);
        margin: 0 auto;
        position: relative;
        z-index: 1;
      }

      .topbar {
        position: sticky;
        top: 0;
        z-index: 5;
        backdrop-filter: blur(12px);
        background: rgba(9, 12, 18, 0.7);
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      }

      .topbar-inner {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 18px 0;
        gap: 20px;
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 14px;
        font-family: var(--font-display);
        letter-spacing: 0.12em;
        text-transform: uppercase;
        font-weight: 600;
      }

      .brand .badge {
        width: 40px;
        height: 40px;
        border-radius: 14px;
        background: linear-gradient(135deg, var(--accent), var(--accent-2));
        box-shadow: 0 0 20px var(--glow);
        display: grid;
        place-items: center;
        color: #111;
        font-weight: 700;
      }

      nav {
        display: flex;
        gap: 18px;
        font-size: 14px;
        color: var(--text-soft);
      }

      nav a {
        position: relative;
      }

      nav a::after {
        content: "";
        position: absolute;
        left: 0;
        bottom: -6px;
        width: 100%;
        height: 2px;
        background: linear-gradient(90deg, var(--accent), transparent);
        opacity: 0;
        transition: opacity 0.2s ease;
      }

      nav a:hover::after {
        opacity: 1;
      }

      .header-actions {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .ghost-button,
      .solid-button,
      .cart-button {
        border-radius: 999px;
        border: 1px solid var(--line);
        padding: 10px 20px;
        font-size: 14px;
        cursor: pointer;
        background: transparent;
        color: var(--text);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      .solid-button {
        background: linear-gradient(135deg, var(--accent), var(--accent-3));
        color: #1a140f;
        font-weight: 600;
        border: none;
        box-shadow: 0 10px 30px rgba(255, 138, 31, 0.3);
      }

      .cart-button {
        position: relative;
        padding-right: 38px;
      }

      .cart-count {
        position: absolute;
        top: -6px;
        right: 6px;
        min-width: 22px;
        height: 22px;
        border-radius: 999px;
        background: var(--accent);
        color: #111;
        font-size: 12px;
        display: grid;
        place-items: center;
        font-weight: 700;
      }

      .ghost-button:hover,
      .solid-button:hover,
      .cart-button:hover {
        transform: translateY(-2px);
      }

      .hero {
        padding: 60px 0 40px;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 30px;
        align-items: center;
      }

      .hero h1 {
        font-family: var(--font-display);
        font-size: clamp(34px, 5vw, 62px);
        line-height: 1.05;
        margin: 0 0 18px;
        letter-spacing: 0.04em;
      }

      .hero p {
        margin: 0 0 24px;
        color: var(--text-soft);
        font-size: 16px;
        max-width: 520px;
      }

      .hero-actions {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        margin-bottom: 24px;
      }

      .hero-metrics {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
      }

      .hero-metric {
        border: 1px solid var(--line);
        padding: 12px 16px;
        border-radius: 14px;
        background: rgba(21, 27, 38, 0.75);
        backdrop-filter: blur(6px);
      }

      .hero-metric span {
        display: block;
        font-family: var(--font-display);
        font-size: 18px;
        font-weight: 600;
      }

      .hero-panel {
        border-radius: var(--radius-lg);
        background: linear-gradient(150deg, #1b2433, #0f141d);
        box-shadow: var(--shadow);
        padding: 26px;
        position: relative;
        overflow: hidden;
      }

      .hero-panel::before {
        content: "";
        position: absolute;
        inset: -40% 20% auto -40%;
        height: 240px;
        background: linear-gradient(90deg, transparent, rgba(255, 138, 31, 0.4));
        transform: rotate(-8deg);
      }

      .hero-panel h3 {
        margin: 0 0 12px;
        font-family: var(--font-display);
        letter-spacing: 0.08em;
      }

      .hero-panel p {
        margin: 0 0 18px;
        font-size: 13px;
      }

      .sound-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }

      .sound-tag {
        font-size: 11px;
        padding: 6px 10px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        color: var(--text-soft);
        text-transform: uppercase;
        letter-spacing: 0.08em;
      }

      .section {
        padding: 60px 0 20px;
      }

      .section-head {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-bottom: 24px;
      }

      .section-head h2 {
        margin: 0;
        font-family: var(--font-display);
        font-size: clamp(24px, 3vw, 38px);
        letter-spacing: 0.06em;
      }

      .section-head p {
        margin: 0;
        color: var(--text-soft);
        max-width: 640px;
      }

      .studio-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 24px;
        align-items: start;
      }

      .panel {
        padding: 20px;
        border-radius: var(--radius-md);
        background: linear-gradient(160deg, var(--surface), var(--surface-2));
        border: 1px solid rgba(255, 255, 255, 0.08);
        box-shadow: 0 14px 30px rgba(0, 0, 0, 0.25);
      }

      .control-stack {
        display: grid;
        gap: 16px;
      }

      .control-block {
        display: grid;
        gap: 8px;
      }

      .control-block label {
        font-size: 13px;
        color: var(--text-soft);
      }

      .control-inline {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        align-items: center;
      }

      .layout-buttons button,
      .filter-btn,
      .toggle-pill {
        padding: 8px 16px;
        border-radius: 999px;
        border: 1px solid var(--line);
        background: transparent;
        color: var(--text-soft);
        cursor: pointer;
        font-size: 13px;
        transition: all 0.2s ease;
      }

      .layout-buttons button.active,
      .filter-btn.active,
      .layout-buttons button:hover,
      .filter-btn:hover,
      .toggle-pill.active {
        color: var(--text);
        border-color: rgba(255, 138, 31, 0.5);
        box-shadow: 0 0 12px rgba(255, 138, 31, 0.25);
      }

      select,
      input[type="text"],
      input[type="file"] {
        background: rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.12);
        color: var(--text);
        padding: 10px 12px;
        border-radius: 12px;
        font-size: 13px;
      }

      input[type="color"] {
        width: 44px;
        height: 36px;
        border-radius: 10px;
        border: none;
        background: none;
        padding: 0;
      }

      .keyboard-frame {
        border-radius: var(--radius-lg);
        padding: 24px;
        background: linear-gradient(135deg, #202b3d, #0f151f);
        border: 1px solid rgba(255, 255, 255, 0.08);
        position: relative;
        overflow: hidden;
      }

      .keyboard-frame::before {
        content: "";
        position: absolute;
        inset: 12px;
        border-radius: 22px;
        border: 1px solid rgba(255, 255, 255, 0.08);
        opacity: 0.6;
        pointer-events: none;
      }

      .keyboard-rows {
        --unit: 34px;
        --gap: 6px;
        display: grid;
        gap: var(--gap);
        align-items: start;
      }

      .keyboard-row {
        display: flex;
        gap: var(--gap);
      }

      .keycap {
        height: var(--unit);
        width: calc(var(--w) * var(--unit));
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        position: relative;
        background-size: 200% 200%;
        background-position: center;
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.2),
          inset 0 -6px 10px rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: flex-start;
        padding: 6px 8px;
        font-size: 10px;
        color: rgba(255, 255, 255, 0.85);
        text-transform: uppercase;
        letter-spacing: 0.08em;
      }

      .keycap.accent {
        border-color: rgba(255, 227, 123, 0.6);
        box-shadow: 0 0 12px rgba(255, 227, 123, 0.35);
        color: #101018;
      }

      .keyboard-frame.finish-gloss .keycap::after {
        content: "";
        position: absolute;
        inset: 4px;
        border-radius: 8px;
        background: linear-gradient(
          150deg,
          rgba(255, 255, 255, 0.28),
          transparent 60%
        );
        pointer-events: none;
      }

      .keyboard-frame.finish-matte .keycap {
        box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.12),
          inset 0 -4px 8px rgba(0, 0, 0, 0.35);
      }

      .keyboard-frame.finish-metal .keycap {
        border-color: rgba(255, 255, 255, 0.3);
        box-shadow: inset 0 1px 2px rgba(255, 255, 255, 0.3),
          inset 0 -8px 12px rgba(0, 0, 0, 0.6);
      }

      .config-summary {
        margin-top: 18px;
        font-size: 13px;
        color: var(--text-soft);
      }

      .filters {
        margin-top: 12px;
        padding: 16px;
        border-radius: var(--radius-md);
        background: rgba(20, 25, 35, 0.8);
        border: 1px solid var(--line);
        display: flex;
        flex-wrap: wrap;
        gap: 14px;
        align-items: center;
        justify-content: space-between;
      }

      .filter-group {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
      }

      .products {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 22px;
        padding: 26px 0 10px;
      }

      .product-card {
        padding: 18px;
        border-radius: var(--radius-md);
        background: linear-gradient(160deg, var(--surface), var(--surface-2));
        border: 1px solid rgba(255, 255, 255, 0.08);
        position: relative;
        overflow: hidden;
        box-shadow: 0 14px 30px rgba(0, 0, 0, 0.25);
        display: flex;
        flex-direction: column;
        gap: 12px;
        min-height: 320px;
      }

      .product-visual {
        position: relative;
        border-radius: 16px;
        padding: 14px;
        background: linear-gradient(135deg, #1f2737, #0c121b);
        border: 1px solid rgba(255, 255, 255, 0.08);
        overflow: hidden;
      }

      .product-visual::after {
        content: "";
        position: absolute;
        inset: 10px;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.05);
        background-image: linear-gradient(
            90deg,
            rgba(255, 255, 255, 0.05) 1px,
            transparent 1px
          ),
          linear-gradient(
            rgba(255, 255, 255, 0.05) 1px,
            transparent 1px
          );
        background-size: 14px 14px;
        opacity: 0.5;
      }

      .product-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 10px;
      }

      .product-name {
        font-family: var(--font-display);
        font-size: 18px;
        margin: 0;
      }

      .product-price {
        font-weight: 600;
        color: var(--accent-3);
      }

      .product-desc {
        color: var(--text-soft);
        font-size: 13px;
        line-height: 1.5;
      }

      .chip-row {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }

      .chip {
        font-size: 11px;
        padding: 6px 10px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        color: var(--text-soft);
        text-transform: uppercase;
        letter-spacing: 0.08em;
      }

      .chip.category {
        color: #0c131c;
        background: linear-gradient(120deg, var(--accent), var(--accent-2));
        border: none;
      }

      .product-action {
        margin-top: auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
      }

      .product-action button {
        padding: 8px 16px;
        border-radius: 999px;
        border: 1px solid rgba(255, 255, 255, 0.15);
        background: transparent;
        color: var(--text);
        cursor: pointer;
      }

      .product-action button:hover {
        border-color: rgba(255, 138, 31, 0.5);
      }

      .section-highlight {
        margin: 40px 0 60px;
        padding: 28px;
        border-radius: var(--radius-lg);
        background: linear-gradient(
          135deg,
          rgba(255, 138, 31, 0.2),
          rgba(15, 20, 28, 0.9)
        );
        border: 1px solid rgba(255, 255, 255, 0.08);
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 20px;
      }

      .highlight-card {
        padding: 18px;
        border-radius: var(--radius-sm);
        background: rgba(13, 18, 26, 0.7);
        border: 1px solid rgba(255, 255, 255, 0.08);
      }

      .highlight-card h3 {
        margin: 0 0 8px;
        font-family: var(--font-display);
        font-size: 16px;
      }

      .highlight-card p {
        margin: 0;
        color: var(--text-soft);
        font-size: 13px;
        line-height: 1.5;
      }

      footer {
        padding: 30px 0 60px;
        color: var(--text-soft);
        font-size: 12px;
      }

      .cart-overlay {
        position: fixed;
        inset: 0;
        background: rgba(5, 6, 8, 0.6);
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.2s ease;
        z-index: 20;
      }

      .cart-overlay.open {
        opacity: 1;
        pointer-events: auto;
      }

      .cart-drawer {
        position: fixed;
        top: 0;
        right: 0;
        height: 100vh;
        width: min(360px, 90vw);
        background: rgba(12, 16, 24, 0.96);
        border-left: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: var(--shadow);
        transform: translateX(100%);
        transition: transform 0.25s ease;
        z-index: 21;
        display: flex;
        flex-direction: column;
      }

      .cart-drawer.open {
        transform: translateX(0);
      }

      .cart-header {
        padding: 18px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .cart-body {
        padding: 18px;
        flex: 1;
        overflow-y: auto;
        display: grid;
        gap: 16px;
      }

      .cart-item {
        padding: 12px;
        border-radius: 12px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.08);
        display: grid;
        gap: 8px;
      }

      .cart-item-head {
        display: flex;
        justify-content: space-between;
        gap: 8px;
        align-items: center;
      }

      .cart-item-name {
        font-weight: 600;
      }

      .cart-item-meta {
        font-size: 12px;
        color: var(--text-soft);
      }

      .cart-controls {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .cart-controls button {
        width: 28px;
        height: 28px;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.12);
        background: transparent;
        color: var(--text);
        cursor: pointer;
      }

      .cart-controls button[data-action="remove"] {
        width: auto;
        padding: 0 12px;
        font-size: 12px;
      }

      .cart-summary {
        padding: 18px;
        border-top: 1px solid rgba(255, 255, 255, 0.08);
        display: grid;
        gap: 10px;
      }

      .cart-summary-row {
        display: flex;
        justify-content: space-between;
      }

      .cart-summary button {
        padding: 10px 16px;
        border-radius: 999px;
        border: none;
        background: var(--accent);
        color: #111;
        font-weight: 600;
        cursor: pointer;
      }

      .cart-empty {
        font-size: 13px;
        color: var(--text-soft);
      }

      /* Chat UI removed */

      @media (max-width: 900px) {
        nav {
          display: none;
        }
      }

      @media (max-width: 768px) {
        .topbar-inner {
          flex-direction: column;
          align-items: flex-start;
        }

        .hero {
          padding-top: 20px;
        }

        .filters {
          flex-direction: column;
          align-items: flex-start;
        }
      }

      @media (prefers-reduced-motion: reduce) {
        * {
          animation: none !important;
          transition: none !important;
        }
      }
    </style>
  </head>
  <body>
    <div class="orb orb-a"></div>
    <div class="orb orb-b"></div>

    <header class="topbar">
      <div class="container topbar-inner">
        <div class="brand">
          <span class="badge">KB</span>
          <span>KBDemo Lab</span>
        </div>
        <nav>
          <a href="#studio">鍵帽工作室</a>
          <a href="#catalog">鍵盤選物</a>
          <a href="#guide">改裝指南</a>
          <a href="#support">支援</a>
        </nav>
        <div class="header-actions">
          <button class="cart-button" id="cart-toggle" type="button">
            購物車
            <span class="cart-count" id="cart-count">0</span>
          </button>
        </div>
      </div>
    </header>

    <main>
      <section class="hero container" id="home">
        <div>
          <h1>客製化鍵盤社群的選物與鍵帽實驗室</h1>
          <p>
            20+ 款電競與客製化鍵盤一次整理，搭配鍵帽漸層與圖片套用模擬。
            所有產品資料可匯出給客服或社群夥伴作為參考。
          </p>
          <div class="hero-actions">
            <button class="solid-button" type="button" data-scroll="#catalog">
              立即探索
            </button>
            <button class="ghost-button" type="button" data-scroll="#studio">
              進入鍵帽工作室
            </button>
          </div>
          <div class="hero-metrics">
            <div class="hero-metric">
              <span>22</span>
              產品型號
            </div>
            <div class="hero-metric">
              <span>1K-10K</span>
              價格帶
            </div>
            <div class="hero-metric">
              <span>100/75/60</span>
              版型選擇
            </div>
          </div>
        </div>
        <div class="hero-panel">
          <h3>聲學取向指標</h3>
          <p>快速掌握每款鍵盤的聲學調性，從 thock 到 clack 都可一眼判斷。</p>
          <div class="sound-tags">
            <span class="sound-tag">Thock</span>
            <span class="sound-tag">Creamy</span>
            <span class="sound-tag">Clack</span>
            <span class="sound-tag">Silent</span>
          </div>
        </div>
      </section>

      <section class="section container" id="studio">
        <div class="section-head">
          <h2>鍵帽工作室</h2>
          <p>
            選擇鍵盤尺寸，設定漸層色票與方向，或上傳圖片直接套用到鍵帽。
            這裡的結果可匯出給客服或夥伴做參考。
          </p>
        </div>
        <div class="studio-grid">
          <div class="panel">
            <div class="control-stack">
              <div class="control-block">
                <label>鍵盤尺寸</label>
                <div class="layout-buttons" id="layout-buttons">
                  <button type="button" data-layout="100">100%</button>
                  <button type="button" data-layout="75" class="active">75%</button>
                  <button type="button" data-layout="60">60%</button>
                </div>
              </div>
              <div class="control-block">
                <label>鍵帽模式</label>
                <div class="control-inline">
                  <select id="keycap-mode">
                    <option value="gradient">漸層鍵帽</option>
                    <option value="image">圖片套用</option>
                  </select>
                  <select id="image-mode">
                    <option value="full">全板覆蓋</option>
                    <option value="tile">每鍵平鋪</option>
                  </select>
                </div>
              </div>
              <div class="control-block">
                <label>漸層色票</label>
                <div class="control-inline">
                  <input type="color" id="grad-color-1" value="#ff8a1f" />
                  <input type="color" id="grad-color-2" value="#ffc857" />
                  <input type="color" id="grad-color-3" value="#4be0b5" />
                  <select id="gradient-angle">
                    <option value="0">由上到下</option>
                    <option value="45">左上到右下</option>
                    <option value="90">由左到右</option>
                    <option value="135" selected>右上到左下</option>
                  </select>
                </div>
              </div>
              <div class="control-block">
                <label>鍵帽材質</label>
                <div class="control-inline">
                  <select id="finish-select">
                    <option value="matte">PBT 霧面</option>
                    <option value="gloss">ABS 亮面</option>
                    <option value="metal">金屬質感</option>
                  </select>
                  <label class="control-inline">
                    <input type="checkbox" id="accent-toggle" checked />
                    <span>高亮 Esc / Enter / Space</span>
                  </label>
                </div>
              </div>
              <div class="control-block">
                <label>圖片套用</label>
                <input type="file" id="image-upload" accept="image/*" />
                <div class="control-inline">
                  <button class="ghost-button" id="image-clear" type="button">
                    清除圖片
                  </button>
                  <span id="image-status" class="product-desc">尚未上傳圖片</span>
                </div>
              </div>
            </div>
          </div>
          <div class="panel">
            <div class="keyboard-frame finish-matte" id="keyboard-frame">
              <div class="keyboard-rows" id="keyboard-rows"></div>
            </div>
            <div class="config-summary" id="config-summary">
              目前配置：75% / 漸層 / PBT 霧面 / Esc Enter Space 強調
            </div>
          </div>
        </div>
      </section>

      <section class="section container" id="catalog">
        <div class="section-head">
          <h2>鍵盤選物</h2>
          <p>電競與客製化鍵盤共 22 款，支援分類與價格排序。</p>
        </div>
        <div class="filters">
          <div class="filter-group" aria-label="分類篩選">
            <button class="filter-btn active" data-filter="all">全部</button>
            <button class="filter-btn" data-filter="custom">客製化</button>
            <button class="filter-btn" data-filter="gaming">電競</button>
          </div>
          <div class="control-inline">
            <label for="sort-select" class="product-desc">排序</label>
            <select id="sort-select">
              <option value="featured">精選</option>
              <option value="price-asc">價格低到高</option>
              <option value="price-desc">價格高到低</option>
              <option value="name">名稱 A-Z</option>
            </select>
          </div>
        </div>
        <section class="products" id="product-grid"></section>
      </section>

      <section class="section container" id="guide">
        <div class="section-head">
          <h2>改裝指南</h2>
          <p>選材、調音、手感與配色的關鍵細節，快速掌握。</p>
        </div>
        <section class="section-highlight">
          <div class="highlight-card">
            <h3>素材選配</h3>
            <p>鋁合金、PC、FR4、黃銅，依聲學需求快速挑配。</p>
          </div>
          <div class="highlight-card">
            <h3>改裝建議</h3>
            <p>靜音棉、衛星軸、鍵帽高度，全都可由客服或社群提供建議。</p>
          </div>
          <div class="highlight-card">
            <h3>聲學取向</h3>
            <p>不只打字，還要聽感。提供 thock / clack / creamy 調性標籤。</p>
          </div>
        </section>
      </section>

      <section class="section container" id="support">
        <div class="section-head">
          <h2>支援</h2>
          <p>購物車可匯出配置，後續溝通請直接透過客服管道。</p>
        </div>
      </section>

      <footer class="container">
        KBDemo 產品資料與配置摘要可供匯出與分享。
      </footer>
    </main>

    <div class="cart-overlay" id="cart-overlay"></div>
    <aside class="cart-drawer" id="cart-drawer" aria-label="購物車">
      <div class="cart-header">
        <strong>購物車</strong>
        <button class="ghost-button" id="cart-close" type="button">關閉</button>
      </div>
      <div class="cart-body" id="cart-items">
        <div class="cart-empty">購物車目前是空的。</div>
      </div>
      <div class="cart-summary">
        <div class="cart-summary-row">
          <span>小計</span>
          <strong id="cart-total">TWD 0</strong>
        </div>
        <button id="cart-clear" type="button">清空購物車</button>
      </div>
    </aside>

    <!-- Chat widget removed -->
    <script>
      window.KBDemoCustomProducts = [
        {
          id: "tofu60",
          name: "Tofu60",
          price: 4800,
          category: "custom",
          layout: "60%",
          detail: "CNC 鋁殼 / Gasket / QMK-VIA",
          sound: "Thock",
          tags: ["熱插拔", "低音", "有線"],
        },
        {
          id: "cycle7",
          name: "Cycle7",
          price: 9800,
          category: "custom",
          layout: "75%",
          detail: "高剛性鋁殼 / FR4 定位板 / 可換配重",
          sound: "Clack",
          tags: ["客製化", "RGB", "有線"],
        },
        {
          id: "neo65",
          name: "Neo65",
          price: 5600,
          category: "custom",
          layout: "65%",
          detail: "雙層棉調音 / PC 定位板 / VIA",
          sound: "Creamy",
          tags: ["柔和手感", "熱插拔", "有線"],
        },
        {
          id: "qk75",
          name: "QK75",
          price: 7200,
          category: "custom",
          layout: "75%",
          detail: "鋁殼 + 黃銅配重 / 旋鈕模組",
          sound: "Thock",
          tags: ["金屬質感", "旋鈕", "有線"],
        },
        {
          id: "zoom65",
          name: "Zoom65",
          price: 6500,
          category: "custom",
          layout: "65%",
          detail: "藍牙三模 / Gasket / 可換背板",
          sound: "Creamy",
          tags: ["無線", "低音", "熱插拔"],
        },
        {
          id: "freebird60",
          name: "Freebird60",
          price: 4200,
          category: "custom",
          layout: "60%",
          detail: "入門客製 / 多配色 / 簡化裝配",
          sound: "Clack",
          tags: ["輕量", "有線", "新手友善"],
        },
        {
          id: "frog-tkl",
          name: "Frog TKL",
          price: 8800,
          category: "custom",
          layout: "TKL",
          detail: "高彈性 Gasket / 綿密聲學 / 可換腳墊",
          sound: "Thock",
          tags: ["彈性手感", "低音", "有線"],
        },
        {
          id: "mode-sonnet",
          name: "Mode Sonnet",
          price: 9200,
          category: "custom",
          layout: "75%",
          detail: "模組化上蓋 / 磁吸飾板 / 高度客製",
          sound: "Creamy",
          tags: ["模組化", "金屬感", "有線"],
        },
        {
          id: "ikki68",
          name: "Ikki68 Aurora",
          price: 5400,
          category: "custom",
          layout: "68%",
          detail: "多配置套件 / 熱插拔 / 可替換上蓋",
          sound: "Thock",
          tags: ["熱插拔", "多配色", "有線"],
        },
        {
          id: "satisfaction75",
          name: "Satisfaction75",
          price: 10000,
          category: "custom",
          layout: "75%",
          detail: "高端客製 / 旋鈕 + OLED / 鋁殼",
          sound: "Thock",
          tags: ["高階", "旋鈕", "有線"],
        },
        {
          id: "monstargear-alice",
          name: "Monstargear Alice",
          price: 7600,
          category: "custom",
          layout: "Alice",
          detail: "人體工學分裂 / Gasket / CNC 鋁殼",
          sound: "Creamy",
          tags: ["人體工學", "低音", "有線"],
        },
        {
          id: "q2-pro",
          name: "Keychron Q2 Pro",
          price: 5900,
          category: "custom",
          layout: "65%",
          detail: "藍牙三模 / 金屬殼 / QMK",
          sound: "Clack",
          tags: ["無線", "金屬感", "熱插拔"],
        },
      ];
    </script>
    <script>
      window.KBDemoGamingProducts = [
        {
          id: "hyperstrike-x87",
          name: "HyperStrike X87",
          price: 3200,
          category: "gaming",
          layout: "TKL",
          detail: "低延遲有線 / 迅速觸發 / RGB 燈效",
          sound: "Clack",
          tags: ["電競", "RGB", "線性軸"],
        },
        {
          id: "thunderedge-65",
          name: "ThunderEdge 65 Pro",
          price: 2600,
          category: "gaming",
          layout: "65%",
          detail: "磁吸掌托 / 雙層隔音 / 遊戲模式",
          sound: "Thock",
          tags: ["快速觸發", "有線", "熱插拔"],
        },
        {
          id: "apex-blitz-mini",
          name: "Apex Blitz Mini",
          price: 1800,
          category: "gaming",
          layout: "60%",
          detail: "小桌面首選 / FPS 專用配置 / 高亮燈效",
          sound: "Clack",
          tags: ["電競", "輕量", "RGB"],
        },
        {
          id: "vortex-pulse-75",
          name: "Vortex Pulse 75",
          price: 3900,
          category: "gaming",
          layout: "75%",
          detail: "無線 2.4G + 有線 / 高續航 / 靜音棉",
          sound: "Silent",
          tags: ["無線", "靜音", "長續航"],
        },
        {
          id: "nova-rapid-100",
          name: "Nova Rapid 100",
          price: 4200,
          category: "gaming",
          layout: "100%",
          detail: "全尺寸 / 快速觸發 / 競技宏鍵",
          sound: "Clack",
          tags: ["全尺寸", "宏鍵", "RGB"],
        },
        {
          id: "phantom-v100",
          name: "Phantom V100",
          price: 5100,
          category: "gaming",
          layout: "100%",
          detail: "鋁合金上蓋 / 熱插拔 / 磁吸掌托",
          sound: "Thock",
          tags: ["全尺寸", "熱插拔", "RGB"],
        },
        {
          id: "stormwave-75",
          name: "Stormwave 75",
          price: 4600,
          category: "gaming",
          layout: "75%",
          detail: "無線三模 / 快速觸發 / 音量旋鈕",
          sound: "Creamy",
          tags: ["無線", "旋鈕", "RGB"],
        },
        {
          id: "arcstrike-60",
          name: "ArcStrike 60",
          price: 2000,
          category: "gaming",
          layout: "60%",
          detail: "輕巧競技 / 大面積背光 / PBT 鍵帽",
          sound: "Clack",
          tags: ["電競", "PBT", "有線"],
        },
        {
          id: "pulse-wireless-98",
          name: "Pulse Wireless 98",
          price: 5300,
          category: "gaming",
          layout: "98%",
          detail: "準全尺寸 / 無線低延遲 / 熱插拔",
          sound: "Thock",
          tags: ["無線", "熱插拔", "長續航"],
        },
        {
          id: "orbit-racer-87",
          name: "Orbit Racer 87",
          price: 3500,
          category: "gaming",
          layout: "TKL",
          detail: "FPS 模式 / 防鬼鍵 / 緊湊桌面",
          sound: "Clack",
          tags: ["防鬼鍵", "有線", "電競"],
        },
      ];
    </script>
    <script>
      const productData = [
        ...window.KBDemoCustomProducts,
        ...window.KBDemoGamingProducts,
      ];
      window.KBDemoProducts = productData;

      const productGrid = document.getElementById("product-grid");
      const filterButtons = document.querySelectorAll(".filter-btn");
      const sortSelect = document.getElementById("sort-select");
      const cartCount = document.getElementById("cart-count");
      const cartDrawer = document.getElementById("cart-drawer");
      const cartOverlay = document.getElementById("cart-overlay");
      const cartItems = document.getElementById("cart-items");
      const cartTotal = document.getElementById("cart-total");
      const cartToggle = document.getElementById("cart-toggle");
      const cartClose = document.getElementById("cart-close");
      const cartClear = document.getElementById("cart-clear");

      const formatPrice = (price) =>
        `TWD ${price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;

      let activeFilter = "all";
      let activeSort = "featured";

      const cartState = {
        items: [],
      };

      const saveCart = () => {
        localStorage.setItem("kbdemo-cart", JSON.stringify(cartState.items));
      };

      const loadCart = () => {
        const stored = localStorage.getItem("kbdemo-cart");
        if (stored) {
          cartState.items = JSON.parse(stored);
        }
      };

      const openCart = () => {
        cartDrawer.classList.add("open");
        cartOverlay.classList.add("open");
      };

      const closeCart = () => {
        cartDrawer.classList.remove("open");
        cartOverlay.classList.remove("open");
      };

      const updateCartCount = () => {
        const count = cartState.items.reduce((sum, item) => sum + item.qty, 0);
        cartCount.textContent = count;
      };

      const renderCart = () => {
        if (cartState.items.length === 0) {
          cartItems.innerHTML = '<div class="cart-empty">購物車目前是空的。</div>';
          cartTotal.textContent = formatPrice(0);
          updateCartCount();
          return;
        }

        cartItems.innerHTML = "";
        let total = 0;
        cartState.items.forEach((item) => {
          const product = productData.find((entry) => entry.id === item.id);
          if (!product) {
            return;
          }
          total += product.price * item.qty;
          const card = document.createElement("div");
          card.className = "cart-item";
          card.innerHTML = `
            <div class="cart-item-head">
              <div>
                <div class="cart-item-name">${product.name}</div>
                <div class="cart-item-meta">${product.layout} / ${
            product.category === "custom" ? "客製化" : "電競"
          }</div>
              </div>
              <div>${formatPrice(product.price)}</div>
            </div>
            <div class="cart-controls">
              <button type="button" data-action="dec" data-id="${product.id}">-</button>
              <span>${item.qty}</span>
              <button type="button" data-action="inc" data-id="${product.id}">+</button>
              <button type="button" data-action="remove" data-id="${product.id}">移除</button>
            </div>
          `;
          cartItems.appendChild(card);
        });
        cartTotal.textContent = formatPrice(total);
        updateCartCount();
      };

      const updateCartItem = (id, delta) => {
        const target = cartState.items.find((item) => item.id === id);
        if (!target) {
          return;
        }
        target.qty += delta;
        if (target.qty <= 0) {
          cartState.items = cartState.items.filter((item) => item.id !== id);
        }
        saveCart();
        renderCart();
      };

      const removeCartItem = (id) => {
        cartState.items = cartState.items.filter((item) => item.id !== id);
        saveCart();
        renderCart();
      };

      const addToCart = (id) => {
        const target = cartState.items.find((item) => item.id === id);
        if (target) {
          target.qty += 1;
        } else {
          cartState.items.push({ id, qty: 1 });
        }
        saveCart();
        renderCart();
        openCart();
      };

      const getFilteredProducts = () => {
        let items = [...productData];
        if (activeFilter !== "all") {
          items = items.filter((item) => item.category === activeFilter);
        }

        if (activeSort === "price-asc") {
          items.sort((a, b) => a.price - b.price);
        } else if (activeSort === "price-desc") {
          items.sort((a, b) => b.price - a.price);
        } else if (activeSort === "name") {
          items.sort((a, b) => a.name.localeCompare(b.name));
        }

        return items;
      };

      const renderProducts = () => {
        const items = getFilteredProducts();
        productGrid.innerHTML = "";
        items.forEach((product) => {
          const card = document.createElement("article");
          card.className = "product-card";
          card.innerHTML = `
            <div class="product-visual"></div>
            <div class="product-meta">
              <h3 class="product-name">${product.name}</h3>
              <div class="product-price">${formatPrice(product.price)}</div>
            </div>
            <div class="product-desc">${product.detail}</div>
            <div class="chip-row">
              <span class="chip category">${
                product.category === "custom" ? "客製化" : "電競"
              }</span>
              <span class="chip">${product.layout}</span>
              <span class="chip">${product.sound}</span>
              ${product.tags
                .map((tag) => `<span class="chip">${tag}</span>`)
                .join("")}
            </div>
            <div class="product-action">
              <span class="product-desc">熱門改裝方案可詢問客服</span>
              <button type="button" data-add="${product.id}">加入購物車</button>
            </div>
          `;
          productGrid.appendChild(card);
        });
      };

      filterButtons.forEach((btn) => {
        btn.addEventListener("click", () => {
          filterButtons.forEach((button) => button.classList.remove("active"));
          btn.classList.add("active");
          activeFilter = btn.dataset.filter;
          renderProducts();
        });
      });

      sortSelect.addEventListener("change", (event) => {
        activeSort = event.target.value;
        renderProducts();
      });

      productGrid.addEventListener("click", (event) => {
        const target = event.target.closest("button[data-add]");
        if (!target) {
          return;
        }
        addToCart(target.dataset.add);
      });

      cartItems.addEventListener("click", (event) => {
        const btn = event.target.closest("button[data-action]");
        if (!btn) {
          return;
        }
        const id = btn.dataset.id;
        if (btn.dataset.action === "inc") {
          updateCartItem(id, 1);
        } else if (btn.dataset.action === "dec") {
          updateCartItem(id, -1);
        } else {
          removeCartItem(id);
        }
      });

      cartToggle.addEventListener("click", openCart);
      cartClose.addEventListener("click", closeCart);
      cartOverlay.addEventListener("click", closeCart);
      cartClear.addEventListener("click", () => {
        cartState.items = [];
        saveCart();
        renderCart();
      });

      const layoutButtons = document.querySelectorAll("#layout-buttons button");
      const keyboardRows = document.getElementById("keyboard-rows");
      const keyboardFrame = document.getElementById("keyboard-frame");
      const configSummary = document.getElementById("config-summary");
      const keycapMode = document.getElementById("keycap-mode");
      const imageMode = document.getElementById("image-mode");
      const gradColors = [
        document.getElementById("grad-color-1"),
        document.getElementById("grad-color-2"),
        document.getElementById("grad-color-3"),
      ];
      const gradientAngle = document.getElementById("gradient-angle");
      const finishSelect = document.getElementById("finish-select");
      const accentToggle = document.getElementById("accent-toggle");
      const imageUpload = document.getElementById("image-upload");
      const imageStatus = document.getElementById("image-status");
      const imageClear = document.getElementById("image-clear");

      const KEY_UNIT = 34;
      const KEY_GAP = 6;
      const accentLabels = new Set(["esc", "enter", "space"]);

      const keycapState = {
        size: "75",
        mode: "gradient",
        imageMode: "full",
        colors: gradColors.map((input) => input.value),
        angle: Number(gradientAngle.value),
        finish: "matte",
        accent: true,
        imageData: null,
      };

      const layoutData = {
        100: {
          rows: [
            [
              { label: "Esc", w: 1 },
              { label: "F1", w: 1 },
              { label: "F2", w: 1 },
              { label: "F3", w: 1 },
              { label: "F4", w: 1 },
              { label: "F5", w: 1 },
              { label: "F6", w: 1 },
              { label: "F7", w: 1 },
              { label: "F8", w: 1 },
              { label: "F9", w: 1 },
              { label: "F10", w: 1 },
              { label: "F11", w: 1 },
              { label: "F12", w: 1 },
              { label: "Prt", w: 1 },
              { label: "Scr", w: 1 },
              { label: "Pause", w: 1 },
              { label: "Num", w: 1 },
              { label: "/", w: 1 },
              { label: "*", w: 1 },
            ],
            [
              { label: "`", w: 1 },
              { label: "1", w: 1 },
              { label: "2", w: 1 },
              { label: "3", w: 1 },
              { label: "4", w: 1 },
              { label: "5", w: 1 },
              { label: "6", w: 1 },
              { label: "7", w: 1 },
              { label: "8", w: 1 },
              { label: "9", w: 1 },
              { label: "0", w: 1 },
              { label: "-", w: 1 },
              { label: "=", w: 1 },
              { label: "Back", w: 2 },
              { label: "Ins", w: 1 },
              { label: "Home", w: 1 },
              { label: "PgUp", w: 1 },
              { label: "7", w: 1 },
              { label: "8", w: 1 },
              { label: "9", w: 1 },
            ],
            [
              { label: "Tab", w: 1.5 },
              { label: "Q", w: 1 },
              { label: "W", w: 1 },
              { label: "E", w: 1 },
              { label: "R", w: 1 },
              { label: "T", w: 1 },
              { label: "Y", w: 1 },
              { label: "U", w: 1 },
              { label: "I", w: 1 },
              { label: "O", w: 1 },
              { label: "P", w: 1 },
              { label: "[", w: 1 },
              { label: "]", w: 1 },
              { label: "\\", w: 1.5 },
              { label: "Del", w: 1 },
              { label: "End", w: 1 },
              { label: "PgDn", w: 1 },
              { label: "4", w: 1 },
              { label: "5", w: 1 },
              { label: "6", w: 1 },
            ],
            [
              { label: "Caps", w: 1.75 },
              { label: "A", w: 1 },
              { label: "S", w: 1 },
              { label: "D", w: 1 },
              { label: "F", w: 1 },
              { label: "G", w: 1 },
              { label: "H", w: 1 },
              { label: "J", w: 1 },
              { label: "K", w: 1 },
              { label: "L", w: 1 },
              { label: ";", w: 1 },
              { label: "'", w: 1 },
              { label: "Enter", w: 2.25 },
              { label: "1", w: 1 },
              { label: "2", w: 1 },
              { label: "3", w: 1 },
            ],
            [
              { label: "Shift", w: 2.25 },
              { label: "Z", w: 1 },
              { label: "X", w: 1 },
              { label: "C", w: 1 },
              { label: "V", w: 1 },
              { label: "B", w: 1 },
              { label: "N", w: 1 },
              { label: "M", w: 1 },
              { label: ",", w: 1 },
              { label: ".", w: 1 },
              { label: "/", w: 1 },
              { label: "Shift", w: 2.75 },
              { label: "Up", w: 1 },
              { label: "0", w: 2 },
              { label: ".", w: 1 },
            ],
            [
              { label: "Ctrl", w: 1.5 },
              { label: "Win", w: 1.25 },
              { label: "Alt", w: 1.25 },
              { label: "Space", w: 6 },
              { label: "Alt", w: 1.25 },
              { label: "Fn", w: 1.25 },
              { label: "Ctrl", w: 1.5 },
              { label: "Left", w: 1 },
              { label: "Down", w: 1 },
              { label: "Right", w: 1 },
              { label: "0", w: 1 },
              { label: "Enter", w: 1 },
            ],
          ],
        },
        75: {
          rows: [
            [
              { label: "Esc", w: 1 },
              { label: "F1", w: 1 },
              { label: "F2", w: 1 },
              { label: "F3", w: 1 },
              { label: "F4", w: 1 },
              { label: "F5", w: 1 },
              { label: "F6", w: 1 },
              { label: "F7", w: 1 },
              { label: "F8", w: 1 },
              { label: "F9", w: 1 },
              { label: "F10", w: 1 },
              { label: "F11", w: 1 },
              { label: "F12", w: 1 },
              { label: "Del", w: 1 },
            ],
            [
              { label: "`", w: 1 },
              { label: "1", w: 1 },
              { label: "2", w: 1 },
              { label: "3", w: 1 },
              { label: "4", w: 1 },
              { label: "5", w: 1 },
              { label: "6", w: 1 },
              { label: "7", w: 1 },
              { label: "8", w: 1 },
              { label: "9", w: 1 },
              { label: "0", w: 1 },
              { label: "-", w: 1 },
              { label: "=", w: 1 },
              { label: "Back", w: 2 },
            ],
            [
              { label: "Tab", w: 1.5 },
              { label: "Q", w: 1 },
              { label: "W", w: 1 },
              { label: "E", w: 1 },
              { label: "R", w: 1 },
              { label: "T", w: 1 },
              { label: "Y", w: 1 },
              { label: "U", w: 1 },
              { label: "I", w: 1 },
              { label: "O", w: 1 },
              { label: "P", w: 1 },
              { label: "[", w: 1 },
              { label: "]", w: 1 },
              { label: "\\", w: 1.5 },
            ],
            [
              { label: "Caps", w: 1.75 },
              { label: "A", w: 1 },
              { label: "S", w: 1 },
              { label: "D", w: 1 },
              { label: "F", w: 1 },
              { label: "G", w: 1 },
              { label: "H", w: 1 },
              { label: "J", w: 1 },
              { label: "K", w: 1 },
              { label: "L", w: 1 },
              { label: ";", w: 1 },
              { label: "'", w: 1 },
              { label: "Enter", w: 2.25 },
            ],
            [
              { label: "Shift", w: 2.25 },
              { label: "Z", w: 1 },
              { label: "X", w: 1 },
              { label: "C", w: 1 },
              { label: "V", w: 1 },
              { label: "B", w: 1 },
              { label: "N", w: 1 },
              { label: "M", w: 1 },
              { label: ",", w: 1 },
              { label: ".", w: 1 },
              { label: "/", w: 1 },
              { label: "Shift", w: 2.75 },
            ],
            [
              { label: "Ctrl", w: 1.5 },
              { label: "Win", w: 1.25 },
              { label: "Alt", w: 1.25 },
              { label: "Space", w: 6 },
              { label: "Fn", w: 1.25 },
              { label: "Alt", w: 1.25 },
              { label: "Left", w: 1 },
              { label: "Down", w: 1 },
              { label: "Right", w: 1 },
            ],
          ],
        },
        60: {
          rows: [
            [
              { label: "Esc", w: 1 },
              { label: "1", w: 1 },
              { label: "2", w: 1 },
              { label: "3", w: 1 },
              { label: "4", w: 1 },
              { label: "5", w: 1 },
              { label: "6", w: 1 },
              { label: "7", w: 1 },
              { label: "8", w: 1 },
              { label: "9", w: 1 },
              { label: "0", w: 1 },
              { label: "-", w: 1 },
              { label: "=", w: 1 },
              { label: "Back", w: 2 },
            ],
            [
              { label: "Tab", w: 1.5 },
              { label: "Q", w: 1 },
              { label: "W", w: 1 },
              { label: "E", w: 1 },
              { label: "R", w: 1 },
              { label: "T", w: 1 },
              { label: "Y", w: 1 },
              { label: "U", w: 1 },
              { label: "I", w: 1 },
              { label: "O", w: 1 },
              { label: "P", w: 1 },
              { label: "[", w: 1 },
              { label: "]", w: 1 },
              { label: "\\", w: 1.5 },
            ],
            [
              { label: "Caps", w: 1.75 },
              { label: "A", w: 1 },
              { label: "S", w: 1 },
              { label: "D", w: 1 },
              { label: "F", w: 1 },
              { label: "G", w: 1 },
              { label: "H", w: 1 },
              { label: "J", w: 1 },
              { label: "K", w: 1 },
              { label: "L", w: 1 },
              { label: ";", w: 1 },
              { label: "'", w: 1 },
              { label: "Enter", w: 2.25 },
            ],
            [
              { label: "Shift", w: 2.25 },
              { label: "Z", w: 1 },
              { label: "X", w: 1 },
              { label: "C", w: 1 },
              { label: "V", w: 1 },
              { label: "B", w: 1 },
              { label: "N", w: 1 },
              { label: "M", w: 1 },
              { label: ",", w: 1 },
              { label: ".", w: 1 },
              { label: "/", w: 1 },
              { label: "Shift", w: 2.75 },
            ],
            [
              { label: "Ctrl", w: 1.5 },
              { label: "Win", w: 1.25 },
              { label: "Alt", w: 1.25 },
              { label: "Space", w: 6 },
              { label: "Alt", w: 1.25 },
              { label: "Fn", w: 1.25 },
              { label: "Ctrl", w: 1.5 },
            ],
          ],
        },
      };

      const renderKeyboard = (sizeKey) => {
        const layout = layoutData[sizeKey];
        keyboardRows.innerHTML = "";
        keyboardRows.style.setProperty("--unit", `${KEY_UNIT}px`);
        keyboardRows.style.setProperty("--gap", `${KEY_GAP}px`);

        let maxUnits = 0;
        layout.rows.forEach((row, rowIndex) => {
          const rowEl = document.createElement("div");
          rowEl.className = "keyboard-row";
          let xUnits = 0;
          row.forEach((key) => {
            const keyEl = document.createElement("div");
            keyEl.className = "keycap";
            keyEl.style.setProperty("--w", key.w);
            keyEl.dataset.x = xUnits;
            keyEl.dataset.y = rowIndex;
            keyEl.dataset.label = key.label.toLowerCase();
            keyEl.textContent = key.label;
            if (keycapState.accent && accentLabels.has(key.label.toLowerCase())) {
              keyEl.classList.add("accent");
            }
            rowEl.appendChild(keyEl);
            xUnits += key.w;
          });
          maxUnits = Math.max(maxUnits, xUnits);
          keyboardRows.appendChild(rowEl);
        });

        keyboardRows.dataset.totalUnits = maxUnits;
        keyboardRows.dataset.totalRows = layout.rows.length;
        applyKeycapStyle();
      };

      const applyAccent = () => {
        const keys = keyboardRows.querySelectorAll(".keycap");
        keys.forEach((key) => {
          const label = key.dataset.label;
          const shouldAccent = keycapState.accent && accentLabels.has(label);
          key.classList.toggle("accent", shouldAccent);
        });
      };

      const applyKeycapStyle = () => {
        const keys = keyboardRows.querySelectorAll(".keycap");
        const totalUnits = Number(keyboardRows.dataset.totalUnits || 1);
        const totalRows = Number(keyboardRows.dataset.totalRows || 1);
        const boardWidth = totalUnits * KEY_UNIT + (totalUnits - 1) * KEY_GAP;
        const boardHeight = totalRows * KEY_UNIT + (totalRows - 1) * KEY_GAP;
        const gradient = `linear-gradient(${keycapState.angle}deg, ${keycapState.colors})`;
        const useImage = keycapState.mode === "image" && keycapState.imageData;

        keys.forEach((key) => {
          const xUnits = Number(key.dataset.x);
          const yUnits = Number(key.dataset.y);
          if (useImage) {
            key.style.backgroundImage = `url(${keycapState.imageData})`;
            if (keycapState.imageMode === "full") {
              const xPx = xUnits * (KEY_UNIT + KEY_GAP);
              const yPx = yUnits * (KEY_UNIT + KEY_GAP);
              key.style.backgroundSize = `${boardWidth}px ${boardHeight}px`;
              key.style.backgroundPosition = `-${xPx}px -${yPx}px`;
              key.style.backgroundRepeat = "no-repeat";
            } else {
              key.style.backgroundSize = "cover";
              key.style.backgroundPosition = "center";
              key.style.backgroundRepeat = "no-repeat";
            }
          } else {
            const xPercent = totalUnits === 1 ? 50 : (xUnits / (totalUnits - 1)) * 100;
            const yPercent = totalRows === 1 ? 50 : (yUnits / (totalRows - 1)) * 100;
            key.style.backgroundImage = gradient;
            key.style.backgroundSize = "200% 200%";
            key.style.backgroundPosition = `${xPercent}% ${yPercent}%`;
          }
        });

        applyAccent();
        updateConfigSummary();
      };

      const updateConfigSummary = () => {
        const modeText = keycapState.mode === "image" ? "圖片" : "漸層";
        const accentText = keycapState.accent ? "Esc Enter Space 強調" : "無重點鍵";
        const finishText =
          keycapState.finish === "matte"
            ? "PBT 霧面"
            : keycapState.finish === "gloss"
            ? "ABS 亮面"
            : "金屬質感";
        configSummary.textContent = `目前配置：${keycapState.size}% / ${modeText} / ${finishText} / ${accentText}`;
      };

      layoutButtons.forEach((button) => {
        button.addEventListener("click", () => {
          layoutButtons.forEach((btn) => btn.classList.remove("active"));
          button.classList.add("active");
          keycapState.size = button.dataset.layout;
          renderKeyboard(button.dataset.layout);
        });
      });

      gradColors.forEach((input, index) => {
        input.addEventListener("input", () => {
          keycapState.colors[index] = input.value;
          applyKeycapStyle();
        });
      });

      gradientAngle.addEventListener("change", (event) => {
        keycapState.angle = Number(event.target.value);
        applyKeycapStyle();
      });

      keycapMode.addEventListener("change", (event) => {
        keycapState.mode = event.target.value;
        applyKeycapStyle();
      });

      imageMode.addEventListener("change", (event) => {
        keycapState.imageMode = event.target.value;
        applyKeycapStyle();
      });

      finishSelect.addEventListener("change", (event) => {
        keyboardFrame.classList.remove("finish-matte", "finish-gloss", "finish-metal");
        keyboardFrame.classList.add(`finish-${event.target.value}`);
        keycapState.finish = event.target.value;
        updateConfigSummary();
      });

      accentToggle.addEventListener("change", (event) => {
        keycapState.accent = event.target.checked;
        applyAccent();
        updateConfigSummary();
      });

      imageUpload.addEventListener("change", (event) => {
        const file = event.target.files[0];
        if (!file) {
          return;
        }
        const reader = new FileReader();
        reader.onload = () => {
          keycapState.imageData = reader.result;
          imageStatus.textContent = `已載入：${file.name}`;
          applyKeycapStyle();
        };
        reader.readAsDataURL(file);
      });

      imageClear.addEventListener("click", () => {
        keycapState.imageData = null;
        imageUpload.value = "";
        imageStatus.textContent = "尚未上傳圖片";
        applyKeycapStyle();
      });

      const scrollButtons = document.querySelectorAll("[data-scroll]");
      scrollButtons.forEach((button) => {
        button.addEventListener("click", () => {
          const target = document.querySelector(button.dataset.scroll);
          if (target) {
            target.scrollIntoView({ behavior: "smooth" });
          }
        });
      });

      loadCart();
      renderProducts();
      renderCart();
      renderKeyboard(keycapState.size);

      // duplicate scroll handler removed
    </script>
  </body>
</html>
